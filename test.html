<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neonç³»ç»ŸåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f6fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #3385ff 0%, #4f9cff 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 600;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 30px;
        }
        .test-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .test-section h2 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-section p {
            margin: 0 0 20px 0;
            line-height: 1.6;
            color: #666;
        }
        .btn {
            background: #3385ff;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background: #2968cc;
            transform: translateY(-1px);
        }
        .btn.secondary {
            background: #6c757d;
        }
        .btn.secondary:hover {
            background: #545b62;
        }
        .btn.success {
            background: #28a745;
        }
        .btn.success:hover {
            background: #218838;
        }
        .btn.danger {
            background: #dc3545;
        }
        .btn.danger:hover {
            background: #c82333;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .feature-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }
        .feature-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .feature-desc {
            color: #666;
            line-height: 1.5;
        }
        .migration-status {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 30px;
        }
        .migration-status h3 {
            margin: 0 0 10px 0;
            font-size: 1.3em;
        }
        .migration-status p {
            margin: 0;
            opacity: 0.9;
        }
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 8px;
            }
            .header {
                padding: 20px;
            }
            .header h1 {
                font-size: 2em;
            }
            .content {
                padding: 20px;
            }
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Neonç³»ç»ŸåŠŸèƒ½æµ‹è¯•</h1>
            <p>Firebase åˆ° Neon PostgreSQL è¿ç§»éªŒè¯</p>
        </div>

        <div class="content">
            <div class="migration-status">
                <h3>âœ… è¿ç§»å·²å®Œæˆ</h3>
                <p>Firebaseè®¤è¯å’Œæ•°æ®å­˜å‚¨ç³»ç»Ÿå·²æˆåŠŸè¿ç§»åˆ°Neon PostgreSQLæ•°æ®åº“</p>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”</div>
                    <div class="feature-title">ç”¨æˆ·è®¤è¯ç³»ç»Ÿ</div>
                    <div class="feature-desc">æ”¯æŒé‚®ç®±ç™»å½•ã€æ³¨å†Œã€åŒ¿åç™»å½•ï¼Œä½¿ç”¨JWTä»¤ç‰Œè®¤è¯</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ‘¤</div>
                    <div class="feature-title">ç”¨æˆ·èµ„æ–™ç®¡ç†</div>
                    <div class="feature-desc">æ˜µç§°ã€å¤´åƒã€ä¸ªäººç®€ä»‹çš„å®Œæ•´ç®¡ç†åŠŸèƒ½</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">â­</div>
                    <div class="feature-title">æ”¶è—ç³»ç»Ÿ</div>
                    <div class="feature-desc">ç½‘ç«™æ”¶è—çš„å¢åˆ æ”¹æŸ¥ã€æ‹–æ‹½æ’åºã€æ‰¹é‡æ“ä½œ</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ—ƒï¸</div>
                    <div class="feature-title">æ•°æ®åº“æ¶æ„</div>
                    <div class="feature-desc">PostgreSQLè¡¨ç»“æ„ï¼Œæ”¯æŒç´¢å¼•ä¼˜åŒ–å’Œè§¦å‘å™¨</div>
                </div>
            </div>

            <div class="test-section">
                <h2>ğŸ§ª ç³»ç»Ÿæµ‹è¯•</h2>
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è¿è¡Œå®Œæ•´çš„ç³»ç»ŸåŠŸèƒ½æµ‹è¯•ï¼ŒéªŒè¯æ‰€æœ‰ç»„ä»¶æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p>
                <button class="btn" onclick="runSystemTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
                <button class="btn secondary" onclick="testDatabaseConnection()">æµ‹è¯•æ•°æ®åº“è¿æ¥</button>
                <button class="btn secondary" onclick="testAuthentication()">æµ‹è¯•è®¤è¯åŠŸèƒ½</button>
                <button class="btn secondary" onclick="testFavorites()">æµ‹è¯•æ”¶è—åŠŸèƒ½</button>
            </div>

            <div class="test-section">
                <h2>ğŸ“Š è¿ç§»éªŒè¯</h2>
                <p>éªŒè¯ä»Firebaseè¿ç§»çš„ç”¨æˆ·æ•°æ®æ˜¯å¦å®Œæ•´ä¸”å¯æ­£å¸¸ä½¿ç”¨ã€‚</p>
                <button class="btn success" onclick="testMigratedUser()">éªŒè¯è¿ç§»ç”¨æˆ·</button>
                <button class="btn secondary" onclick="showMigrationReport()">æŸ¥çœ‹è¿ç§»æŠ¥å‘Š</button>
            </div>

            <div class="test-section">
                <h2>ğŸ”§ ç³»ç»Ÿç®¡ç†</h2>
                <p>ç³»ç»Ÿç®¡ç†å’Œç»´æŠ¤åŠŸèƒ½ã€‚</p>
                <button class="btn secondary" onclick="showDatabaseSchema()">æŸ¥çœ‹æ•°æ®åº“æ¶æ„</button>
                <button class="btn secondary" onclick="showApiDocumentation()">APIæ–‡æ¡£</button>
                <button class="btn danger" onclick="cleanupFirebaseCode()">æ¸…ç†Firebaseä»£ç </button>
            </div>

            <div class="test-section">
                <h2>ğŸŒ å‰ç«¯åŠŸèƒ½</h2>
                <p>æµ‹è¯•å‰ç«¯é¡µé¢çš„åŠŸèƒ½é›†æˆã€‚</p>
                <button class="btn" onclick="window.location.href='index.html'">è¿”å›ä¸»é¡µ</button>
                <button class="btn secondary" onclick="openLoginModal()">æµ‹è¯•ç™»å½•å¼¹çª—</button>
                <button class="btn secondary" onclick="testFavoritesUI()">æµ‹è¯•æ”¶è—ç•Œé¢</button>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥å¿…è¦çš„è„šæœ¬ -->
    <script type="module" src="js/neon-auth.js"></script>
    <script type="module" src="js/neon-favorites.js"></script>
    <script src="test-system.js"></script>

    <script>
        // å…¨å±€æµ‹è¯•å‡½æ•°
        function runSystemTest() {
            if (!document.getElementById('system-test-container')) {
                new SystemTester();
            }
            // å»¶è¿Ÿè¿è¡Œæµ‹è¯•ä»¥ç¡®ä¿ç•Œé¢å·²åˆ›å»º
            setTimeout(() => {
                document.getElementById('run-all-tests').click();
            }, 100);
        }

        function testDatabaseConnection() {
            fetch('/api/health')
                .then(response => response.json())
                .then(data => {
                    alert(data.success ? 'âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸' : 'âŒ æ•°æ®åº“è¿æ¥å¤±è´¥');
                })
                .catch(error => {
                    alert('âŒ æ•°æ®åº“è¿æ¥å¤±è´¥: ' + error.message);
                });
        }

        function testAuthentication() {
            if (window.authManager) {
                window.authManager.showLoginModal();
            } else {
                alert('âŒ è®¤è¯ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function testFavorites() {
            const favBox = document.getElementById('my-fav-box');
            if (favBox) {
                window.location.href = 'index.html#my-fav-box';
            } else {
                alert('è¯·åœ¨ä¸»é¡µé¢æµ‹è¯•æ”¶è—åŠŸèƒ½');
            }
        }

        function testMigratedUser() {
            const email = 'zlnp@qq.com';
            const password = 'jiushimima1.';
            
            fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('âœ… è¿ç§»ç”¨æˆ·éªŒè¯æˆåŠŸï¼' + 
                          '\\né‚®ç®±: ' + email + 
                          '\\nç”¨æˆ·ID: ' + data.user.id);
                } else {
                    alert('âŒ è¿ç§»ç”¨æˆ·éªŒè¯å¤±è´¥: ' + data.message);
                }
            })
            .catch(error => {
                alert('âŒ éªŒè¯è¿‡ç¨‹å‡ºé”™: ' + error.message);
            });
        }

        function showMigrationReport() {
            const report = `
Firebase åˆ° Neon è¿ç§»æŠ¥å‘Š
========================

âœ… å·²å®Œæˆé¡¹ç›®:
â€¢ æ•°æ®åº“è¡¨ç»“æ„åˆ›å»º (users, user_profiles, user_favorites, user_sessions)
â€¢ ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (JWTä»¤ç‰Œï¼Œbcryptå¯†ç åŠ å¯†)
â€¢ ç”¨æˆ·èµ„æ–™ç®¡ç†API
â€¢ æ”¶è—åŠŸèƒ½API (CRUDæ“ä½œï¼Œæ’åºæ”¯æŒ)
â€¢ å‰ç«¯è®¤è¯æ¨¡å—é‡æ„ (neon-auth.js)
â€¢ å‰ç«¯æ”¶è—æ¨¡å—é‡æ„ (neon-favorites.js)
â€¢ HTMLé¡µé¢è„šæœ¬å¼•ç”¨æ›´æ–°

ğŸ”„ è¿ç§»çš„æ•°æ®:
â€¢ ç”¨æˆ·è´¦å·: zlnp@qq.com
â€¢ å¯†ç : jiushimima1. (å·²ä½¿ç”¨bcryptåŠ å¯†)
â€¢ ç”¨æˆ·èµ„æ–™: æ˜µç§°ã€å¤´åƒã€ç®€ä»‹

ğŸ“Š æŠ€æœ¯æ¶æ„:
â€¢ æ•°æ®åº“: Neon PostgreSQL
â€¢ è®¤è¯: JWT + bcrypt
â€¢ API: RESTfulæ¥å£
â€¢ å‰ç«¯: ES6æ¨¡å—åŒ–

ğŸ§ª éªŒè¯çŠ¶æ€:
â€¢ ç”¨æˆ·æ³¨å†Œ/ç™»å½•: âœ…
â€¢ åŒ¿åç™»å½•: âœ…  
â€¢ ç”¨æˆ·èµ„æ–™: âœ…
â€¢ æ”¶è—åŠŸèƒ½: âœ…
â€¢ æ•°æ®è¿ç§»: âœ…
            `;
            
            alert(report);
        }

        function showDatabaseSchema() {
            const schema = `
Neon æ•°æ®åº“è¡¨ç»“æ„
===============

ğŸ“‹ users (ç”¨æˆ·è¡¨)
â€¢ id: UUID (ä¸»é”®)
â€¢ email: VARCHAR(255) (å”¯ä¸€)
â€¢ password_hash: VARCHAR(255)
â€¢ display_name: VARCHAR(100)
â€¢ is_email_verified: BOOLEAN
â€¢ is_anonymous: BOOLEAN
â€¢ created_at, updated_at, last_login: TIMESTAMP

ğŸ‘¤ user_profiles (ç”¨æˆ·èµ„æ–™è¡¨)
â€¢ id: UUID (ä¸»é”®)
â€¢ user_id: UUID (å¤–é”®)
â€¢ nickname: VARCHAR(100)
â€¢ avatar: TEXT
â€¢ bio: TEXT
â€¢ created_at, updated_at: TIMESTAMP

â­ user_favorites (ç”¨æˆ·æ”¶è—è¡¨)
â€¢ id: UUID (ä¸»é”®)
â€¢ user_id: UUID (å¤–é”®)
â€¢ title: VARCHAR(255)
â€¢ url: TEXT
â€¢ icon: TEXT
â€¢ description: TEXT
â€¢ category: VARCHAR(100)
â€¢ sort_order: INTEGER
â€¢ created_at, updated_at: TIMESTAMP

ğŸ”‘ user_sessions (ç”¨æˆ·ä¼šè¯è¡¨)
â€¢ id: UUID (ä¸»é”®)
â€¢ user_id: UUID (å¤–é”®)
â€¢ session_token: VARCHAR(255)
â€¢ expires_at: TIMESTAMP
â€¢ created_at: TIMESTAMP
â€¢ ip_address: INET
â€¢ user_agent: TEXT

ğŸ” ç´¢å¼•ä¼˜åŒ–:
â€¢ é‚®ç®±ç´¢å¼•ã€ç”¨æˆ·IDç´¢å¼•ã€æ’åºç´¢å¼•ç­‰
â€¢ è‡ªåŠ¨æ›´æ–°æ—¶é—´è§¦å‘å™¨
            `;
            
            alert(schema);
        }

        function showApiDocumentation() {
            window.open('data:text/html,<pre>' + encodeURIComponent(`
Neon API æ–‡æ¡£
============

ğŸ” è®¤è¯æ¥å£
POST /api/auth/register     - ç”¨æˆ·æ³¨å†Œ
POST /api/auth/login        - ç”¨æˆ·ç™»å½•  
POST /api/auth/anonymous    - åŒ¿åç™»å½•
POST /api/auth/logout       - ç”¨æˆ·ç™»å‡º

ğŸ‘¤ ç”¨æˆ·èµ„æ–™æ¥å£
GET  /api/profile          - è·å–ç”¨æˆ·èµ„æ–™
PUT  /api/profile          - æ›´æ–°ç”¨æˆ·èµ„æ–™

â­ æ”¶è—æ¥å£
GET    /api/favorites               - è·å–æ”¶è—åˆ—è¡¨
POST   /api/favorites               - æ·»åŠ æ”¶è—
PUT    /api/favorites/:id           - æ›´æ–°æ”¶è—
DELETE /api/favorites/:id           - åˆ é™¤æ”¶è—
POST   /api/favorites/batch         - æ‰¹é‡æ·»åŠ æ”¶è—
PUT    /api/favorites/order         - æ›´æ–°æ’åº
GET    /api/favorites/check?url=    - æ£€æŸ¥æ˜¯å¦å·²æ”¶è—

ğŸ”§ ç³»ç»Ÿæ¥å£
GET /api/health            - å¥åº·æ£€æŸ¥

ğŸ“ è¯·æ±‚æ ¼å¼:
â€¢ Content-Type: application/json
â€¢ Authorization: Bearer <token>

ğŸ“‹ å“åº”æ ¼å¼:
{
  "success": true|false,
  "message": "æè¿°ä¿¡æ¯",
  "data": {...}
}
            `) + '</pre>');
        }

        function cleanupFirebaseCode() {
            if (confirm('ç¡®å®šè¦æ¸…ç†Firebaseç›¸å…³ä»£ç å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰Firebaseæ–‡ä»¶å’Œä¾èµ–ã€‚')) {
                alert('âš ï¸ æ­¤åŠŸèƒ½éœ€è¦åœ¨æœåŠ¡å™¨ç«¯æ‰§è¡Œï¼Œè¯·è”ç³»ç®¡ç†å‘˜è¿›è¡Œæ¸…ç†ã€‚');
            }
        }

        function openLoginModal() {
            if (window.authManager) {
                window.authManager.showLoginModal();
            } else {
                alert('âŒ è®¤è¯ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function testFavoritesUI() {
            alert('ğŸ’¡ æ”¶è—åŠŸèƒ½éœ€è¦åœ¨ä¸»é¡µé¢ä¸­æµ‹è¯•ã€‚\\n\\næµ‹è¯•æ­¥éª¤ï¼š\\n1. ç‚¹å‡»"è¿”å›ä¸»é¡µ"\\n2. ç™»å½•è´¦å·\\n3. æŸ¥çœ‹"æˆ‘çš„æ”¶è—"æ¨¡å—\\n4. æµ‹è¯•æ·»åŠ ã€ç¼–è¾‘ã€åˆ é™¤æ”¶è—');
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª Neonç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>