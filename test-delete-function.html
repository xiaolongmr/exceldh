<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ é™¤åŠŸèƒ½éªŒè¯</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 900px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .console-log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .delete-button {
            background: #dc3545;
        }
        .delete-button:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ—‘ï¸ åˆ é™¤åŠŸèƒ½éªŒè¯é¡µé¢</h1>
        
        <div class="test-section success">
            <h3>âœ… ä¿®å¤å†…å®¹</h3>
            <ul>
                <li><strong>UUIDè·¯ç”±åŒ¹é…</strong> - ä¿®å¤UUIDæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é—®é¢˜</li>
                <li><strong>å“åº”æ–¹æ³•ä¿®å¤</strong> - ä½¿ç”¨åŸç”ŸNode.jså“åº”æ–¹æ³•æ›¿ä»£Expressé£æ ¼</li>
                <li><strong>è¯¦ç»†æ—¥å¿—è®°å½•</strong> - å¢åŠ åˆ é™¤è¿‡ç¨‹çš„è¯¦ç»†æ—¥å¿—</li>
                <li><strong>é”™è¯¯å¤„ç†å¢å¼º</strong> - æ”¹è¿›é”™è¯¯æç¤ºå’ŒçŠ¶æ€ç </li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª é—®é¢˜è¯Šæ–­</h3>
            <p><strong>åŸå§‹é”™è¯¯ï¼š</strong></p>
            <div class="console-log">
DELETE http://localhost:3000/api/favorites/6dc4f3a4-c716-43f3-9a37-bd53b44696a0 404 (Not Found)
â— APIè¯·æ±‚å¤±è´¥: 404 {"success":false,"error":"API endpoint not found","details":null}
            </div>
            
            <p><strong>é—®é¢˜åŸå› ï¼š</strong></p>
            <ul>
                <li>UUIDæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å¤±è´¥</li>
                <li>å“åº”å¯¹è±¡æ–¹æ³•ä¸å…¼å®¹</li>
                <li>è·¯ç”±å¤„ç†é€»è¾‘æœ‰ç¼ºé™·</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ æµ‹è¯•åˆ é™¤åŠŸèƒ½</h3>
            <button class="test-button" onclick="testUUIDMatching()">æµ‹è¯•UUIDåŒ¹é…</button>
            <button class="test-button" onclick="checkLoginStatus()">æ£€æŸ¥ç™»å½•çŠ¶æ€</button>
            <button class="test-button delete-button" onclick="simulateDelete()">æ¨¡æ‹Ÿåˆ é™¤è¯·æ±‚</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ å®æ—¶æ—¥å¿—</h3>
            <div id="console-output" class="console-log">
                <div>ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
            </div>
            <button class="test-button" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ éªŒè¯æ­¥éª¤</h3>
            <ol>
                <li>ç¡®ä¿æœåŠ¡å™¨å·²é‡æ–°å¯åŠ¨å¹¶åŠ è½½ä¿®å¤åçš„ä»£ç </li>
                <li>ç™»å½•æ‚¨çš„è´¦æˆ·</li>
                <li>è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼ˆç‚¹å‡»âš™ï¸ç¼–è¾‘æŒ‰é’®ï¼‰</li>
                <li>å°è¯•åˆ é™¤ä¸€ä¸ªæ”¶è—é¡¹ç›®ï¼ˆç‚¹å‡»Ã—æŒ‰é’®ï¼‰</li>
                <li>æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºæˆåŠŸæç¤ºå¹¶åˆ·æ–°åˆ—è¡¨</li>
            </ol>
        </div>
    </div>

    <script>
        console.log('ğŸ—‘ï¸ åˆ é™¤åŠŸèƒ½éªŒè¯é¡µé¢å·²åŠ è½½');
        
        let logs = [];
        
        // æ•è·æ§åˆ¶å°æ—¥å¿—
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            logToDisplay('LOG', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            logToDisplay('ERROR', args.join(' '));
        };
        
        function logToDisplay(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type}: ${message}`;
            logs.push(logEntry);
            
            const output = document.getElementById('console-output');
            if (output) {
                output.innerHTML += `<div style="color: ${type === 'ERROR' ? 'red' : 'black'}">${logEntry}</div>`;
                output.scrollTop = output.scrollHeight;
            }
        }
        
        // æµ‹è¯•UUIDåŒ¹é…
        function testUUIDMatching() {
            console.log('ğŸ§ª æµ‹è¯•UUIDåŒ¹é…åŠŸèƒ½');
            
            const testUUIDs = [
                '6dc4f3a4-c716-43f3-9a37-bd53b44696a0',
                'cd38f3a5-b687-410c-83cb-def7f86ca195',
                'invalid-uuid',
                '123e4567-e89b-12d3-a456-426614174000'
            ];
            
            const uuidRegex = /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;
            
            testUUIDs.forEach(uuid => {
                const isValid = uuidRegex.test(uuid);
                console.log(`UUID: ${uuid} -> åŒ¹é…: ${isValid ? 'âœ…' : 'âŒ'}`);
            });
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            console.log('ğŸ§ª æ£€æŸ¥ç™»å½•çŠ¶æ€');
            
            const token = localStorage.getItem('neon_auth_token');
            if (token) {
                console.log('âœ… æ‰¾åˆ°è®¤è¯ä»¤ç‰Œ');
                
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    console.log('ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯:', payload);
                } catch (e) {
                    console.error('âŒ ä»¤ç‰Œè§£æå¤±è´¥:', e.message);
                }
            } else {
                console.error('âŒ æœªæ‰¾åˆ°è®¤è¯ä»¤ç‰Œï¼Œè¯·å…ˆç™»å½•');
            }
        }
        
        // æ¨¡æ‹Ÿåˆ é™¤è¯·æ±‚
        async function simulateDelete() {
            console.log('ğŸ§ª æ¨¡æ‹Ÿåˆ é™¤è¯·æ±‚');
            
            const token = localStorage.getItem('neon_auth_token');
            if (!token) {
                console.error('âŒ ç”¨æˆ·æœªç™»å½•ï¼Œæ— æ³•æµ‹è¯•åˆ é™¤åŠŸèƒ½');
                return;
            }
            
            // ä½¿ç”¨ä¸€ä¸ªæµ‹è¯•UUID
            const testUUID = '6dc4f3a4-c716-43f3-9a37-bd53b44696a0';
            console.log(`ğŸ¯ æµ‹è¯•åˆ é™¤UUID: ${testUUID}`);
            
            try {
                const response = await fetch(`/api/favorites/${testUUID}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                console.log(`ğŸ“ APIå“åº”çŠ¶æ€: ${response.status}`);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… åˆ é™¤è¯·æ±‚æˆåŠŸ:', data);
                } else {
                    const errorData = await response.json();
                    console.log(`âŒ åˆ é™¤è¯·æ±‚å¤±è´¥:`, errorData);
                    
                    if (response.status === 404) {
                        console.log('â„¹ï¸ è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæµ‹è¯•UUIDå¯èƒ½ä¸å­˜åœ¨');
                    }
                }
            } catch (error) {
                console.error('âŒ ç½‘ç»œé”™è¯¯:', error.message);
            }
        }
        
        function clearLogs() {
            const output = document.getElementById('console-output');
            if (output) {
                output.innerHTML = '<div>æ—¥å¿—å·²æ¸…ç©º...</div>';
                logs = [];
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸš€ åˆ é™¤åŠŸèƒ½éªŒè¯é¡µé¢å‡†å¤‡å°±ç»ª');
            
            setTimeout(() => {
                testUUIDMatching();
                checkLoginStatus();
            }, 1000);
        });
    </script>
</body>
</html>