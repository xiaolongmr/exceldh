<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å—åŠ è½½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 8px 5px;
            font-size: 14px;
        }
        .test-btn:hover {
            background: #0056b3;
        }
        #test-results {
            background: #1e1e1e;
            color: #ffffff;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ æ¨¡å—åŠ è½½æµ‹è¯•é¡µé¢</h1>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯• Neon ç³»ç»Ÿæ¨¡å—çš„åŠ è½½å’Œæœç´¢æ¡†é˜²è‡ªåŠ¨å¡«å……åŠŸèƒ½ã€‚</p>
        
        <div>
            <button class="test-btn" onclick="testModules()">ğŸ” æµ‹è¯•æ¨¡å—åŠ è½½</button>
            <button class="test-btn" onclick="testSearchBox()">ğŸ” æµ‹è¯•æœç´¢æ¡†</button>
            <button class="test-btn" onclick="testFunctions()">âš™ï¸ æµ‹è¯•å‡½æ•°è°ƒç”¨</button>
            <button class="test-btn" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
        </div>
        
        <!-- æ¨¡æ‹Ÿæœç´¢æ¡† -->
        <div style="margin: 20px 0;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">æµ‹è¯•æœç´¢æ¡†:</label>
            <input id="txt" type="text" placeholder="è¿™ä¸ªæœç´¢æ¡†åº”è¯¥ä¿æŒä¸ºç©º" style="width: 300px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <div id="search-clear" style="display: none; color: red;">æ¸…é™¤æŒ‰é’®</div>
        </div>
        
        <div id="test-results"></div>
    </div>

    <!-- åŠ è½½æ ¸å¿ƒæ¨¡å— -->
    <script type="module" src="js/neon-auth.js"></script>
    <script type="module" src="js/neon-favorites.js"></script>
    
    <!-- åŠ è½½æœç´¢å’Œç›‘æ§è„šæœ¬ -->
    <script src="js/search.js"></script>
    <script src="js/module-monitor.js"></script>
    <script src="js/quick-module-check.js"></script>

    <script>
        const output = document.getElementById('test-results');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = {
                'success': 'âœ…',
                'error': 'âŒ',
                'warning': 'âš ï¸',
                'info': 'ğŸ“'
            }[type] || 'ğŸ“';
            
            output.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            output.scrollTop = output.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function testModules() {
            log('å¼€å§‹æµ‹è¯•æ¨¡å—åŠ è½½çŠ¶æ€...', 'info');
            
            // æµ‹è¯•å…³é”®æ¨¡å—
            const modules = [
                { name: 'authManager', expected: 'object' },
                { name: 'loadFavsFromCloud', expected: 'function' },
                { name: 'renderFavs', expected: 'function' },
                { name: 'showLoginModal', expected: 'function' },
                { name: 'closeLoginModal', expected: 'function' }
            ];
            
            let loadedCount = 0;
            modules.forEach(module => {
                const actual = typeof window[module.name];
                const loaded = actual === module.expected;
                
                if (loaded) {
                    log(`${module.name}: ${actual} âœ“`, 'success');
                    loadedCount++;
                } else {
                    log(`${module.name}: æœŸæœ› ${module.expected}, å®é™… ${actual}`, 'error');
                }
            });
            
            const loadRate = Math.round((loadedCount / modules.length) * 100);
            log(`æ¨¡å—åŠ è½½å®Œæˆåº¦: ${loadedCount}/${modules.length} (${loadRate}%)`, 
                loadRate === 100 ? 'success' : 'warning');
                
            // è°ƒç”¨å¿«é€Ÿæ¨¡å—æ£€æŸ¥
            if (window.quickModuleCheck) {
                log('è°ƒç”¨å¿«é€Ÿæ¨¡å—æ£€æŸ¥...', 'info');
                window.quickModuleCheck();
            }
        }

        function testSearchBox() {
            log('å¼€å§‹æµ‹è¯•æœç´¢æ¡†åŠŸèƒ½...', 'info');
            
            const searchInput = document.getElementById('txt');
            if (searchInput) {
                const currentValue = searchInput.value;
                log(`æœç´¢æ¡†å½“å‰å€¼: "${currentValue}"`, 'info');
                
                if (currentValue === '') {
                    log('æœç´¢æ¡†ä¸ºç©º - é˜²è‡ªåŠ¨å¡«å……æˆåŠŸ', 'success');
                } else {
                    log('æœç´¢æ¡†æœ‰å†…å®¹ - å¯èƒ½æ˜¯è‡ªåŠ¨å¡«å……', 'warning');
                }
                
                // æ£€æŸ¥å±æ€§
                const autocomplete = searchInput.getAttribute('autocomplete');
                const type = searchInput.type;
                log(`autocompleteå±æ€§: ${autocomplete}`, autocomplete === 'off' ? 'success' : 'warning');
                log(`inputç±»å‹: ${type}`, type === 'search' ? 'success' : 'warning');
                
                // æ£€æŸ¥æ¸…é™¤æŒ‰é’®çŠ¶æ€
                const clearBtn = document.getElementById('search-clear');
                if (clearBtn) {
                    const isHidden = clearBtn.style.display === 'none';
                    log(`æ¸…é™¤æŒ‰é’®çŠ¶æ€: ${isHidden ? 'å·²éšè—' : 'æ˜¾ç¤ºä¸­'}`, isHidden ? 'success' : 'warning');
                }
            } else {
                log('æœç´¢æ¡†å…ƒç´ ä¸å­˜åœ¨', 'error');
            }
        }

        function testFunctions() {
            log('å¼€å§‹æµ‹è¯•å‡½æ•°è°ƒç”¨...', 'info');
            
            // æµ‹è¯•loadFavsFromCloudå‡½æ•°
            if (typeof window.loadFavsFromCloud === 'function') {
                log('loadFavsFromCloudå‡½æ•°å­˜åœ¨ï¼Œå‡†å¤‡æµ‹è¯•è°ƒç”¨...', 'success');
                try {
                    // è¿™é‡Œåªæ˜¯æµ‹è¯•å‡½æ•°æ˜¯å¦å¯è°ƒç”¨ï¼Œä¸æ‰§è¡ŒçœŸæ­£çš„ç½‘ç»œè¯·æ±‚
                    log('loadFavsFromCloudå‡½æ•°å¯æ­£å¸¸è°ƒç”¨', 'success');
                } catch (error) {
                    log(`loadFavsFromCloudè°ƒç”¨å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('loadFavsFromCloudå‡½æ•°ä¸å­˜åœ¨', 'error');
            }
            
            // æµ‹è¯•renderFavså‡½æ•°
            if (typeof window.renderFavs === 'function') {
                log('renderFavså‡½æ•°å­˜åœ¨', 'success');
            } else {
                log('renderFavså‡½æ•°ä¸å­˜åœ¨', 'error');
            }
            
            // æµ‹è¯•è®¤è¯ç®¡ç†å™¨
            if (window.authManager) {
                log('authManagerå¯¹è±¡å­˜åœ¨', 'success');
                const methods = ['showLoginModal', 'closeLoginModal', 'handleLogin', 'handleLogout'];
                methods.forEach(method => {
                    if (typeof window.authManager[method] === 'function') {
                        log(`authManager.${method}æ–¹æ³•å­˜åœ¨`, 'success');
                    } else {
                        log(`authManager.${method}æ–¹æ³•ä¸å­˜åœ¨`, 'warning');
                    }
                });
            } else {
                log('authManagerå¯¹è±¡ä¸å­˜åœ¨', 'error');
            }
        }

        function clearResults() {
            output.textContent = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹è‡ªåŠ¨æ£€æŸ¥...', 'info');
                testModules();
                testSearchBox();
            }, 2000);
        });
        
        // ç›‘å¬æ¨¡å—åŠ è½½äº‹ä»¶
        window.addEventListener('neonFavoritesLoaded', (event) => {
            log('æ”¶åˆ°neonFavoritesLoadedäº‹ä»¶', 'success');
            log('äº‹ä»¶è¯¦æƒ…: ' + JSON.stringify(event.detail), 'info');
        });
        
        console.log('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…æ¨¡å—åŠ è½½å®Œæˆ...');
    </script>
</body>
</html>