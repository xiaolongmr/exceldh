<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æµ‹è¯•é¡µé¢</title>
    <link rel="stylesheet" href="css/favorites.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .test-section h2 {
            color: #333;
            margin-bottom: 15px;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.pending { background: #fff3cd; color: #856404; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        #console-output {
            background: #1e1e1e;
            color: #ffffff;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Neonæ”¶è—ç³»ç»ŸåŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
            <div id="system-status">
                <p>APIæœåŠ¡å™¨: <span id="api-status" class="status pending">æ£€æµ‹ä¸­...</span></p>
                <p>è®¤è¯çŠ¶æ€: <span id="auth-status" class="status pending">æ£€æµ‹ä¸­...</span></p>
                <p>æ•°æ®åº“è¿æ¥: <span id="db-status" class="status pending">æ£€æµ‹ä¸­...</span></p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”§ åŠŸèƒ½æ¨¡å—æµ‹è¯•</h2>
            <div>
                <button class="test-button" onclick="testLoadFavorites()">ğŸ“‹ æµ‹è¯•åŠ è½½æ”¶è—</button>
                <button class="test-button" onclick="testLoadGroups()">ğŸ“ æµ‹è¯•åŠ è½½åˆ†ç»„</button>
                <button class="test-button" onclick="testIconUpload()">ğŸ–¼ï¸ æµ‹è¯•å›¾æ ‡ä¸Šä¼ </button>
                <button class="test-button" onclick="testCreateGroup()">â• æµ‹è¯•åˆ›å»ºåˆ†ç»„</button>
                <button class="test-button" onclick="testCreateShare()">ğŸ”— æµ‹è¯•åˆ›å»ºåˆ†äº«</button>
                <button class="test-button" onclick="testDeleteFavorite()">ğŸ—‘ï¸ æµ‹è¯•åˆ é™¤æ”¶è—</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ æ¨¡æ‹Ÿæ”¶è—åŒºåŸŸ</h2>
            <div class="my-fav-box">
                <div class="my-fav-box-header">
                    <div class="my-fav-box-title">
                        <span class="my-fav-box-title-icon">ğŸŒŸ æˆ‘çš„æ”¶è—</span>
                    </div>
                    <div class="my-fav-box-actions">
                        <button id="fav-custom-btn" class="my-fav-box-btn">
                            <span>âš™ï¸ç¼–è¾‘</span>
                        </button>
                        <button id="share-btn" class="my-fav-box-btn" onclick="toggleSelectionMode()">
                            <span>ğŸ’° åˆ†äº«æ”¶è—</span>
                        </button>
                        <button id="fav-batch-add-btn" class="my-fav-box-btn">
                            <span>â¡ï¸ æœ¬ç«™æ•°æ®</span>
                        </button>
                    </div>
                </div>
                
                <!-- åˆ†ç»„é€‰é¡¹å¡ -->
                <div id="group-tabs-container" class="group-tabs">
                    <!-- åˆ†ç»„é€‰é¡¹å¡å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- åˆ†äº«æ§ä»¶ -->
                <div id="share-controls" class="share-controls" style="display: none;">
                    <!-- åˆ†äº«æ§ä»¶å°†ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div id="fav-list">
                    <!-- æ”¶è—é¡¹ç›®å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“‹ æ§åˆ¶å°è¾“å‡º</h2>
            <div id="console-output"></div>
            <button class="test-button" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
        </div>
    </div>

    <!-- æ¨¡æ‹Ÿæ·»åŠ æ”¶è—è¡¨å• -->
    <div id="fav-form-modal" style="display: none;">
        <div class="modal-content">
            <h3 class="modal-title">æ·»åŠ æ”¶è—</h3>
            <div class="form-group">
                <label>URLé“¾æ¥åœ°å€:</label>
                <input id="fav-form-url" type="text" placeholder="å®Œæ•´é“¾æ¥æˆ–åŸŸå">
                <button type="button" class="test-button" onclick="autoGetIcon()">è‡ªåŠ¨è·å–</button>
            </div>
            <div class="form-group">
                <label>ç½‘ç«™åç§°:</label>
                <input id="fav-form-title" type="text" placeholder="ç½‘ç«™åç§°">
            </div>
            <div class="form-group">
                <label>ç½‘ç«™å›¾æ ‡:</label>
                <div style="display:flex;align-items:center;gap:8px;">
                    <img id="icon-preview-img-html" src="" alt="é¢„è§ˆ" style="width:32px;height:32px;border-radius:8px;box-shadow:0 2px 8px #e0e0e0;object-fit:cover;">
                    <input id="fav-form-icon" type="text" placeholder="å¡«å†™å›¾æ ‡çš„URLåœ°å€">
                </div>
                <div class="form-group">
                    <button type="button" id="icon-upload-btn-html">ç‚¹æˆ‘æœ¬åœ°ä¸Šä¼ </button>
                </div>
            </div>
            <div class="form-group">
                <label>ç½‘ç«™æè¿°:</label>
                <input id="fav-form-desc" type="text" placeholder="ç½‘ç«™æè¿°ï¼ˆå¯é€‰ï¼‰">
            </div>
            <div class="modal-actions">
                <button type="button" class="test-button" onclick="closeFavForm()">å–æ¶ˆ</button>
                <button type="button" class="test-button" onclick="confirmEditFavForm()">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script>
        // APIåŸºç¡€é…ç½®
        window.API_BASE_URL = 'http://localhost:3000/api';
        
        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? 'âŒ' : 'ğŸ“';
            const color = type === 'error' ? '#ff6b6b' : '#ffffff';
            
            consoleOutput.innerHTML += `<span style="color: ${color}">[${timestamp}] ${prefix} ${message}</span>\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // ä¹Ÿè¾“å‡ºåˆ°åŸå§‹æ§åˆ¶å°
            if (type === 'error') {
                originalError(message);
            } else {
                originalLog(message);
            }
        }
        
        console.log = function(...args) {
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            addToConsole(args.join(' '), 'error');
        };
        
        function clearConsole() {
            consoleOutput.innerHTML = '';
        }
        
        // ç³»ç»ŸçŠ¶æ€æ£€æŸ¥
        async function checkSystemStatus() {
            console.log('ğŸ” å¼€å§‹ç³»ç»ŸçŠ¶æ€æ£€æŸ¥...');
            
            // æ£€æŸ¥APIæœåŠ¡å™¨
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    document.getElementById('api-status').textContent = 'æ­£å¸¸';
                    document.getElementById('api-status').className = 'status success';
                    console.log('âœ… APIæœåŠ¡å™¨çŠ¶æ€æ­£å¸¸');
                } else {
                    throw new Error('APIå“åº”å¼‚å¸¸');
                }
            } catch (error) {
                document.getElementById('api-status').textContent = 'å¼‚å¸¸';
                document.getElementById('api-status').className = 'status error';
                console.error('âŒ APIæœåŠ¡å™¨è¿æ¥å¤±è´¥:', error.message);
            }
            
            // æ£€æŸ¥è®¤è¯çŠ¶æ€
            const token = localStorage.getItem('neon_auth_token');
            if (token) {
                document.getElementById('auth-status').textContent = 'å·²ç™»å½•';
                document.getElementById('auth-status').className = 'status success';
                console.log('âœ… ç”¨æˆ·å·²è®¤è¯');
            } else {
                document.getElementById('auth-status').textContent = 'æœªç™»å½•';
                document.getElementById('auth-status').className = 'status error';
                console.log('âš ï¸ ç”¨æˆ·æœªè®¤è¯');
            }
            
            // æ£€æŸ¥æ•°æ®åº“è¿æ¥ï¼ˆé€šè¿‡è·å–æ”¶è—æ¥æµ‹è¯•ï¼‰
            try {
                const response = await fetch(`${API_BASE_URL}/favorites`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    document.getElementById('db-status').textContent = 'æ­£å¸¸';
                    document.getElementById('db-status').className = 'status success';
                    console.log('âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸');
                } else {
                    throw new Error('æ•°æ®åº“æŸ¥è¯¢å¤±è´¥');
                }
            } catch (error) {
                document.getElementById('db-status').textContent = 'å¼‚å¸¸';
                document.getElementById('db-status').className = 'status error';
                console.error('âŒ æ•°æ®åº“è¿æ¥å¼‚å¸¸:', error.message);
            }
        }
        
        // æµ‹è¯•å‡½æ•°
        async function testLoadFavorites() {
            console.log('ğŸ§ª æµ‹è¯•åŠ è½½æ”¶è—åŠŸèƒ½...');
            if (typeof window.loadFavsFromCloud === 'function') {
                await window.loadFavsFromCloud();
                console.log('âœ… æ”¶è—åŠ è½½åŠŸèƒ½æµ‹è¯•å®Œæˆ');
            } else {
                console.error('âŒ loadFavsFromCloudå‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        async function testLoadGroups() {
            console.log('ğŸ§ª æµ‹è¯•åŠ è½½åˆ†ç»„åŠŸèƒ½...');
            if (typeof window.loadFavoriteGroups === 'function') {
                await window.loadFavoriteGroups();
                console.log('âœ… åˆ†ç»„åŠ è½½åŠŸèƒ½æµ‹è¯•å®Œæˆ');
            } else {
                console.error('âŒ loadFavoriteGroupså‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        function testIconUpload() {
            console.log('ğŸ§ª æµ‹è¯•å›¾æ ‡ä¸Šä¼ åŠŸèƒ½...');
            if (typeof window.initIconUploadFeature === 'function') {
                window.initIconUploadFeature();
                console.log('âœ… å›¾æ ‡ä¸Šä¼ åŠŸèƒ½åˆå§‹åŒ–å®Œæˆ');
            } else {
                console.error('âŒ initIconUploadFeatureå‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        async function testCreateGroup() {
            console.log('ğŸ§ª æµ‹è¯•åˆ›å»ºåˆ†ç»„åŠŸèƒ½...');
            if (typeof window.createFavoriteGroup === 'function') {
                const result = await window.createFavoriteGroup('æµ‹è¯•åˆ†ç»„', 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•åˆ†ç»„', '#ff6b6b');
                console.log('âœ… åˆ†ç»„åˆ›å»ºåŠŸèƒ½æµ‹è¯•å®Œæˆ:', result);
            } else {
                console.error('âŒ createFavoriteGroupå‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        async function testCreateShare() {
            console.log('ğŸ§ª æµ‹è¯•åˆ›å»ºåˆ†äº«åŠŸèƒ½...');
            if (typeof window.createFavoriteShare === 'function') {
                // æ¨¡æ‹Ÿé€‰æ‹©ä¸€äº›æ”¶è—è¿›è¡Œåˆ†äº«
                const result = await window.createFavoriteShare('æµ‹è¯•åˆ†äº«', 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•åˆ†äº«', [], null, 0);
                console.log('âœ… åˆ†äº«åˆ›å»ºåŠŸèƒ½æµ‹è¯•å®Œæˆ:', result);
            } else {
                console.error('âŒ createFavoriteShareå‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        function testDeleteFavorite() {
            console.log('ğŸ§ª æµ‹è¯•åˆ é™¤æ”¶è—åŠŸèƒ½...');
            if (typeof window.removeFav === 'function') {
                console.log('âœ… åˆ é™¤åŠŸèƒ½å­˜åœ¨ï¼Œä½†ä¸æ‰§è¡ŒçœŸå®åˆ é™¤');
            } else {
                console.error('âŒ removeFavå‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(checkSystemStatus, 1000);
        });
    </script>
    
    <!-- åŠ è½½Neonç³»ç»Ÿ -->
    <script type="module" src="js/neon-auth.js"></script>
    <script src="js/neon-favorites-global.js"></script>
    
    <script>
        console.log('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œç­‰å¾…ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ...');
    </script>
</body>
</html>